
import { Meta, Story, Canvas } from '@storybook/blocks';

<Meta title="Modules/Authentication/Configuration" />

# Extending NextAuth

The NextAuth configuration for the project is maintained in the packages/auth/src/config.ts file. This file acts as the centralized location for defining and managing authentication settings, specifically for Cognito login integration. 



## Profile Callback

Ensure new user properties are populated by modifying the profile callback for each relevant provider:

```typescript
Cognito({
  // Cognito configuration
  profile(profile) {
    return {
      ...originalProfileMapping,
      department: profile['custom:department'], // Map new property
      location: profile['custom:location'],     // Map new property
    };
  },
}),
```


## Extending Session Properties

To extend the Session interface to include more properties:

```typescript
declare module "next-auth" {
  interface Session {
    user: User & DefaultSession["user"];
    accessToken?: string;   // New property
    refreshToken?: string;  // New property
  }
}
```

## Update Session Callback

Incorporate new properties within the session callback function to ensure they persist across sessions:

``` typescript
callbacks: {
    session: (opts) => {
      if (!("user" in opts))
        throw new Error("unreachable with session strategy");

      return {
        ...opts.session,
        user: {
          ...opts.session.user,
          id: opts.user.id,
        family_name: opts.user.family_name,
        given_name: opts.user.given_name,
        image: opts.user.image,
        roles: opts.user.roles,
        email: opts.user.email,
        job_title: opts.user.job_title,       

        },
      };
    },
  },
```


## Implementing Changes Securely

### Environment Variables

Secure sensitive information such as client secrets and keys are using environment variables. These are example Cognito. Follow the focumentaiton for your provider

```
AUTH_COGNITO_ID=XXXXXXXXXXXXXXXXXXXXXXXXXX
AUTH_COGNITO_SECRET=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
AUTH_COGNITO_ISSUER=https://cognito-idp.ap-southeast-2.amazonaws.com/ap-southeast-2_XXXXXXXX
```



## Adding New Providers or Configurations

To introduce new providers or alter existing settings, locate your `authConfig` object:

### Example: Adding a GitHub Provider

```typescript
import GitHub from "next-auth/providers/github";

// Add GitHub to the list of providers
export const authConfig = {
  ...otherConfigs,
  providers: [
    ...existingProviders,
    GitHub({
      clientId: process.env.GITHUB_CLIENT_ID,
      clientSecret: process.env.GITHUB_CLIENT_SECRET,
      // Additional options if necessary
    }),
  ],
};
```

Dynamic Options
If your provider requires dynamic options, utilize environment variables or implement logic within the provider configuration.

Extending User Properties
Expand the User interface by declaring additional properties in the next-auth module:

```typescript
declare module "next-auth" {
  interface User {
    id?: string;
    family_name: string;
    given_name: string;
    image?: string | null;
    roles: string[];
    email?: string | null;
    job_title: string;
    department: string; // New property
    location: string;   // New property
  }
}
```

